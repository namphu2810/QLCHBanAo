@model QLCHBanAo.Models.SanPham

@{
    ViewData["Title"] = "Chi tiết sản phẩm";
}

<div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <h4 class="modal-title text-primary fw-bold">Xem chi tiết sản phẩm</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <!-- Tabs -->
                <ul class="nav nav-tabs fw-semibold">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#info">Thông tin sản phẩm</button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#variant">Biến thể sản phẩm</button>
                    </li>
                </ul>

                <!-- Tab content -->
                <div class="tab-content mt-4">

                    <!-- ========== TAB 1: FORM SẢN PHẨM ========== -->
                    <div id="info" class="tab-pane fade show active">
                        <h5 class="fw-bold mb-3 text-primary">Thông tin sản phẩm</h5>
                        <div class="mb-3">
                            <strong>Tên sản phẩm:</strong>
                            <p class="mt-1">@(Model?.TenSanPham ?? "N/A")</p>
                        </div>
                        <div class="mb-3">
                            <strong>Mô tả:</strong>
                            <p class="mt-1">@(Model?.MoTa ?? "Chưa có mô tả")</p>
                        </div>
                        <div class="mb-3">
                            <strong>Hình ảnh:</strong>
                            <div class="mt-2" style="width:100%; min-height:200px; border:dashed 1px gray; border-radius:10px; display:flex; justify-content:center; align-items:center; padding:10px">
                                @if (!string.IsNullOrEmpty(Model?.HinhAnh))
                                {
                                    <img src="~/Images/SanPham/@Model.HinhAnh" alt="@Model.TenSanPham" style="max-width:100%; max-height:200px; object-fit:contain"/>

                                }
                                else if (Model?.BienThe != null && Model.BienThe.Any() && Model.BienThe.FirstOrDefault(b => !string.IsNullOrEmpty(b.BienTheHinhAnh)) != null)
                                {
                                    var firstBienThe = Model.BienThe.FirstOrDefault(b => !string.IsNullOrEmpty(b.BienTheHinhAnh));

                                    var URL_Image = "~/Images/SanPham/" + firstBienThe;
                                    <img src="https://bizweb.dktcdn.net/100/407/972/products/ao-thun-the-thao-35.jpg?v=1671002103983" alt="@URL_Image" style="max-width:100%; max-height:200px; object-fit:contain" />
                                }
                                else
                                {
                                    <span class="text-muted">Chưa có hình ảnh</span>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- ========== TAB 2: BIẾN THỂ ========== -->
                    <div id="variant" class="tab-pane fade">
                        <h5 class="fw-bold mb-3 text-primary">Biến thể sản phẩm</h5>
                        @if (Model?.BienThe != null && Model.BienThe.Any())
                        {
                            <div class="row">
                                @foreach (var bienThe in Model.BienThe)
                                {
                                    <div class="col-md-6 mb-4">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title fw-bold">Biến thể #@bienThe.Id</h6>
                                                
                                                @if (!string.IsNullOrEmpty(bienThe.BienTheHinhAnh))
                                                {
                                                    <div class="mb-2" style="width:100%; height:150px; border:1px solid #ddd; border-radius:5px; display:flex; justify-content:center; align-items:center; overflow:hidden">
                                                        <img src="@Url.Content($"~/Images/SanPham/{bienThe.BienTheHinhAnh}")" alt="Biến thể @bienThe.Id" style="max-width:100%; max-height:100%; object-fit:contain" />
                                                    </div>
                                                }
                                                
                                                <div class="row g-2">
                                                    <div class="col-6">
                                                        <strong>Màu sắc:</strong>
                                                        <p class="mb-0">@(bienThe.MauSac?.TenMau ?? "N/A")</p>
                                                    </div>
                                                    <div class="col-6">
                                                        <strong>Kích thước:</strong>
                                                        <p class="mb-0">@(bienThe.KichThuoc?.TenKichThuoc ?? "N/A")</p>
                                                    </div>
                                                    <div class="col-6">
                                                        <strong>Chất liệu:</strong>
                                                        <p class="mb-0">@(bienThe.ChatLieu?.TenChatLieu ?? "N/A")</p>
                                                    </div>
                                                    <div class="col-6">
                                                        <strong>Thương hiệu:</strong>
                                                        <p class="mb-0">@(bienThe.ThuongHieu?.TenThuongHieu ?? "N/A")</p>
                                                    </div>
                                                </div>

                                                @if (bienThe.TonKhoSP != null && bienThe.TonKhoSP.Any())
                                                {
                                                    <hr class="my-2"/>
                                                    <strong>Tồn kho:</strong>
                                                    <div class="mt-2">
                                                        @foreach (var tonKho in bienThe.TonKhoSP)
                                                        {
                                                            <div class="d-flex justify-content-between mb-1">
                                                                <span>@(tonKho.CuaHang?.TenCuaHang ?? $"Cửa hàng {tonKho.CuaHang_ID}"):</span>
                                                                <span class="fw-semibold">@tonKho.SoLuongTon sản phẩm - @tonKho.DonGia.ToString("N0")₫</span>
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p class="text-muted">Chưa có biến thể nào cho sản phẩm này.</p>
                        }
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-primary px-4">Sửa</a>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script>
        // Tự động hiển thị modal khi trang được tải
        document.addEventListener('DOMContentLoaded', function () {
            var modal = new bootstrap.Modal(document.getElementById('productModal'));
            modal.show();
        });
    </script>
}
